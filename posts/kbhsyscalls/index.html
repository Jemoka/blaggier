<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin=anonymous></script><meta name=viewport content="width=device-width,initial-scale=1"><script src=https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4></script><link rel=preconnect href=https://fonts.bunny.net><link href="https://fonts.bunny.net/css?family=ibm-plex-sans:300,400,400i,500,500i,600,700,700i" rel=stylesheet><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script>window.MathJax={loader:{load:["[tex]/physics"]},tex:{packages:{"[+]":["physics"]}}}</script><title>syscalls</title>
<meta name=description content="syscalls are public functions that allow user land operations to access system-level services (such as reading a sector) which otherwise is locked in kernel mode because they require special privileges.
These functions are called completely isolated to another function: 1) private stack frame 2) private memory, etc.
open, close, read, write
kernel mode
kernel mode allows superuser function access such as reading sectors, etc. which would be dangerous if public.
file
open
int open(const char *pathname, int flags, mode_t mode);
Flags are a bitwise OR operations: you have to open with O_RDONLY (read only), O_WRONLY (write only), or O_RDWR (both read and write). This returns \(-1\) if the reading fails."><meta name=author content="Houjun Liu"><link rel=stylesheet href=/css/all.css><link rel=stylesheet href=/css/page.css><link rel=stylesheet href=/css/syntax.css><link rel=stylesheet href=/css/typography.css><link rel=stylesheet href=/css/components.css></head><body><div class="center-clearfix p-10" style="max-width:1200px;margin:0 auto"><header class=pb-4><span class="w-full flex justify-between flex-wrap"><div style=font-weight:600;font-size:15px><a style=border:0;cursor:pointer href=/><img src=/images/Logo_Transparent.png style=width:17px;display:inline-block;margin-right:8px;transform:translateY(-2.7px)></a>syscalls</div><span style="float:right;display:flex;align-items:center;margin-top:5px;width:100%;max-width:400px;background:#fff;border-radius:2px;border:1px solid var(--gray-2);position:relative"><i class="fa-solid fa-magnifying-glass" style=font-size:12px;color:var(--yellow-fg);margin-right:7px;margin-left:10px></i><div style=width:100%><input id=search-query-inline name=s type=text autocomplete=off placeholder="Search Knowledgebase" enterkeyhint=search></div><div id=search-result-inline style=display:none></div><script id=search-result-template type=text/x-js-template data-template=searchresult>
    <a href="${link}" class="search-link">
    <div class="search-result-item" id="search-result-item-${key}">
        <div class="search-result-title">${title}</div>
        <div class="search-result-summary">${snippet}</div>
    </div>
    </a>
</script><script src=https://code.jquery.com/jquery-3.3.1.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.0/fuse.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js></script><script type=module>
    import { create, insertMultiple, search } from 'https://cdn.jsdelivr.net/npm/@orama/orama@latest/+esm'
    let template = $('script[data-template="searchresult"]').text().split(/\$\{(.+?)\}/g);

    function render(props) {
        return function(tok, i) { return (i % 2) ? props[tok] : tok; };
    }

    const db = create({
        schema: {
            title: 'string',
            content: 'string',
        },
    });
    $.get("https://www.jemoka.com/index.json", function(data, status){
        insertMultiple(db, data.map(x =>
            ({title: x.title, content: x.contents, link: x.permalink})));
    });
    $("#search-result-inline").attr("tabindex", "-1");
    $(document).on("click", function (e) {
    if (!$(e.target).closest("#search-query-inline, #search-result-inline").length) {
        $("#search-result-inline").hide();
    }
    });
    
    
    
    
    
    

    $("#search-query-inline").on("focus keyup", function () {
        let value = $(this).val();
        if (value.trim() == "") {
            $("#search-result-inline").html("");
            $("#search-result-inline").hide();
            return;
        }
        $("#search-result-inline").show();
        let results = search(db, {mode: "fulltext", term: value});
        let contents = results.hits.map(x => template.map(render({
            title: x.document.title,
            snippet: x.document.content.slice(0, 52),
            key: x.id,
            link: x.document.link
        })).join(''));
        $("#search-result-inline").html(contents.join("\n"));
        
    });
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
        $('#search-query-inline').on('focus', function(){
            
            $(this).data('fontSize', $(this).css('font-size')).css('font-size', '16px');
        }).on('blur', function(){
            
            $(this).css('font-size', $(this).data('fontSize'));
        });
    }

</script></span></span><div class=w-full style="padding-bottom:4px;border-bottom:1px solid var(--gray-1);margin-top:1px"></div></header><aside id=tocbox><div id=heading style=padding-left:40px;font-weight:600;font-size:11px;color:var(--gray-3)>contents</div><div id=toc></div></aside><main><article><div style=max-width:700px><p><a href=/posts/kbhsyscalls/>syscalls</a> are public functions that allow user land operations to access system-level services (such as reading a sector) which otherwise is locked in <a href=#kernel-mode>kernel mode</a> because they require special privileges.</p><p>These functions are called completely isolated to another function: 1) private stack frame 2) private memory, etc.</p><p><code>open</code>, <code>close</code>, <code>read</code>, <code>write</code></p><h2 id=kernel-mode>kernel mode</h2><p><a href=#kernel-mode>kernel mode</a> allows superuser function access such as reading <a href=/posts/kbhfilesystem/#disk>sector</a>s, etc. which would be dangerous if public.</p><h2 id=file>file</h2><h3 id=open>open</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#00a8c8>int</span> <span style=color:#75af00>open</span><span style=color:#111>(</span><span style=color:#00a8c8>const</span> <span style=color:#00a8c8>char</span> <span style=color:#f92672>*</span><span style=color:#111>pathname</span><span style=color:#111>,</span> <span style=color:#00a8c8>int</span> <span style=color:#111>flags</span><span style=color:#111>,</span> <span style=color:#00a8c8>mode_t</span> <span style=color:#111>mode</span><span style=color:#111>);</span>
</span></span></code></pre></div><p>Flags are a bitwise OR operations: you have to open with <code>O_RDONLY</code> (read only), <code>O_WRONLY</code> (write only), or <code>O_RDWR</code> (both read and write). This returns \(-1\) if the reading fails.</p><p>Other flags:</p><ul><li><code>O_TRUNC</code> (truncate file)</li><li><code>O_CREAT</code> (creating a file if not exist), which will require a <code>mode_t mode</code> parameter to set the permission</li><li><code>O_EXCL</code> (file must not exist)</li></ul><h3 id=close>close</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#00a8c8>int</span> <span style=color:#75af00>close</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>fd</span><span style=color:#111>);</span>
</span></span></code></pre></div><p><code>ssize_t</code> is a type that is a <code>size_t</code> which accepts <code>-1</code>.</p><h3 id=read>read</h3><p>get a block of a file</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#00a8c8>ssize_t</span> <span style=color:#75af00>read</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>fd</span><span style=color:#111>,</span> <span style=color:#00a8c8>void</span> <span style=color:#f92672>*</span><span style=color:#111>buf</span><span style=color:#111>,</span> <span style=color:#00a8c8>size_t</span> <span style=color:#111>count</span><span style=color:#111>);</span>
</span></span></code></pre></div><p>Returns the number of bytes actually read (for instance, if count is too large, it will only return the number of bytes read). \(0\) if EOF, \(-1\) on error.</p><ol><li>read my nat read all the bytes</li><li>the OS keeps track of where you are reading from</li></ol><h3 id=write>write</h3><p>writes a block of a file</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#00a8c8>ssize_t</span> <span style=color:#75af00>write</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>fd</span><span style=color:#111>,</span> <span style=color:#00a8c8>void</span> <span style=color:#f92672>*</span><span style=color:#111>buf</span><span style=color:#111>,</span> <span style=color:#00a8c8>size_t</span> <span style=color:#111>count</span><span style=color:#111>);</span>
</span></span></code></pre></div><p>Returns the number of bytes actually read (for instance, if count is too large, it will only return the number of bytes read). \(0\) if EOF, \(-1\) on error.</p><h2 id=file-descriptor>file descriptor</h2><p>After we open a file, file descriptors, which are ints, which track where the reading head is in the file; so you can have multiple descriptors each with a different location</p><p><a href=#file-descriptor>file descriptor</a> is used to model access to a variety of resources:</p><ol><li>network connections</li><li>printers/services</li></ol><p>and special file descriptors:</p><ul><li>0: <code>STDIN_FILENO</code> &mdash; input from the terminal</li><li>1: <code>STDOUT_FILENO</code> &mdash; output to the terminal</li><li>2: <code>STDERR_FILENO</code> &mdash; error to the terminal</li></ul></div></article></main><footer style=margin-top:20px><p id=footer style=font-size:8px;color:var(--gray-3)>&copy; 2019-2025 Houjun Liu. Licensed CC BY-NC-SA 4.0.</p></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.32.2/tocbot.min.js></script><script>tocbot.init({tocSelector:"#toc",contentSelector:".center-clearfix",headingSelector:"h1, h2, h3",hasInnerContainers:!0})</script></body></html>