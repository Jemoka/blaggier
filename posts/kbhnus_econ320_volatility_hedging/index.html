<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin=anonymous></script><meta name=viewport content="width=device-width,initial-scale=1"><script src=https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4></script><link rel=preconnect href=https://fonts.bunny.net><link href="https://fonts.bunny.net/css?family=ibm-plex-sans:300,400,400i,500,500i,600,700,700i" rel=stylesheet><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script>window.MathJax={loader:{load:["[tex]/physics"]},tex:{packages:{"[+]":["physics"]}}}</script><title>NUS-ECON320 Volatility Hedging</title>
<meta name=description content="Let \(X\) denote price and \(Y\) denote volatility. The two objects obey the following process:
\begin{equation}
\begin{cases}
\dd{X} = \mu X \dd{t} + XY \dd{W} \\
\dd{Y} = \sigma Y \dd{B}
\end{cases}
\end{equation}
where, \(W\) and \(B\) are correlated Brownian motions with correlation \(\rho\) &mdash; \(E[(\dd{W})(\dd{B})] = \rho \dd{t}\).

Let&rsquo;s work with \(Y\) first. We understand that \(Y\) is some continuous variable \(e^{a}\). Therefore, \(\dv{Y}{t}=ae^{a}\). Therefore, \(dY = ae^{a}dt\). Finally, then \(\frac{\dd{Y}}{Y} = \frac{ae^{a}}{e^{a}}\dd{t} = a\)."><meta name=author content="Houjun Liu"><link rel=stylesheet href=/css/all.css><link rel=stylesheet href=/css/page.css><link rel=stylesheet href=/css/syntax.css><link rel=stylesheet href=/css/typography.css><link rel=stylesheet href=/css/components.css></head><body><div class="center-clearfix p-10" style="max-width:1200px;margin:0 auto"><header class=pb-4><span class="w-full flex justify-between flex-wrap"><div style=font-weight:600;font-size:15px><a style=border:0;cursor:pointer href=/><img src=/images/Logo_Transparent.png style=width:17px;display:inline-block;margin-right:8px;transform:translateY(-2.7px)></a>NUS-ECON320 Volatility Hedging</div><span style="float:right;display:flex;align-items:center;margin-top:5px;width:100%;max-width:400px;background:#fff;border-radius:2px;border:1px solid var(--gray-2);position:relative"><i class="fa-solid fa-magnifying-glass" style=font-size:12px;color:var(--yellow-fg);margin-right:7px;margin-left:10px></i><div style=width:100%><input id=search-query-inline name=s type=text autocomplete=off placeholder="Search Knowledgebase" enterkeyhint=search></div><div id=search-result-inline style=display:none></div><script id=search-result-template type=text/x-js-template data-template=searchresult>
    <a href="${link}" class="search-link">
    <div class="search-result-item" id="search-result-item-${key}">
        <div class="search-result-title">${title}</div>
        <div class="search-result-summary">${snippet}</div>
    </div>
    </a>
</script><script src=https://code.jquery.com/jquery-3.3.1.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.0/fuse.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js></script><script type=module>
    import { create, insertMultiple, search } from 'https://cdn.jsdelivr.net/npm/@orama/orama@latest/+esm'
    let template = $('script[data-template="searchresult"]').text().split(/\$\{(.+?)\}/g);

    function render(props) {
        return function(tok, i) { return (i % 2) ? props[tok] : tok; };
    }

    const db = create({
        schema: {
            title: 'string',
            content: 'string',
        },
    });
    $.get("https://www.jemoka.com/index.json", function(data, status){
        insertMultiple(db, data.map(x =>
            ({title: x.title, content: x.contents, link: x.permalink})));
    });
    $("#search-result-inline").attr("tabindex", "-1");
    $(document).on("click", function (e) {
    if (!$(e.target).closest("#search-query-inline, #search-result-inline").length) {
        $("#search-result-inline").hide();
    }
    });
    
    
    
    
    
    

    $("#search-query-inline").on("focus keyup", function () {
        let value = $(this).val();
        if (value.trim() == "") {
            $("#search-result-inline").html("");
            $("#search-result-inline").hide();
            return;
        }
        $("#search-result-inline").show();
        let results = search(db, {mode: "fulltext", term: value});
        let contents = results.hits.map(x => template.map(render({
            title: x.document.title,
            snippet: x.document.content.slice(0, 52),
            key: x.id,
            link: x.document.link
        })).join(''));
        $("#search-result-inline").html(contents.join("\n"));
        
    });
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
        $('#search-query-inline').on('focus', function(){
            
            $(this).data('fontSize', $(this).css('font-size')).css('font-size', '16px');
        }).on('blur', function(){
            
            $(this).css('font-size', $(this).data('fontSize'));
        });
    }

</script></span></span><div class=w-full style="padding-bottom:4px;border-bottom:1px solid var(--gray-1);margin-top:1px"></div></header><main><article><div style=max-width:700px><p>Let \(X\) denote price and \(Y\) denote volatility. The two objects obey the following process:</p><p>\begin{equation}
\begin{cases}
\dd{X} = \mu X \dd{t} + XY \dd{W} \\
\dd{Y} = \sigma Y \dd{B}
\end{cases}
\end{equation}</p><p>where, \(W\) and \(B\) are correlated Brownian motions with correlation \(\rho\) &mdash; \(E[(\dd{W})(\dd{B})] = \rho \dd{t}\).</p><hr><p>Let&rsquo;s work with \(Y\) first. We understand that \(Y\) is some continuous variable \(e^{a}\). Therefore, \(\dv{Y}{t}=ae^{a}\). Therefore, \(dY = ae^{a}dt\). Finally, then \(\frac{\dd{Y}}{Y} = \frac{ae^{a}}{e^{a}}\dd{t} = a\).</p><p>Finally, then, because we defined \(Y=e^{a} \implies \ln Y = a = \frac{\dd{Y}}{Y}\).</p><p>So, we have that:</p><p>\begin{align}
&\dd{Y} = \sigma Y\dd{B} \\
\Rightarrow\ & \dd{\log Y} = \frac{\sigma Y\dd{B}}{Y} = \sigma \dd{B}
\end{align}</p><p>This tells that the change in log returns in \(Y\) is <a href=/posts/kbhnormal_distribution/>normal</a> (as \(B\) is a <a href=/posts/kbhbrownian_motion/>Brownian Motion</a>), with a standard deviation of \(\sigma\). Therefore:</p><p>\begin{equation}
\dd{\log Y} \sim \mathcal{N}(0, \sigma^{2} \dd{t})
\end{equation}</p><p>We therefore see that the log-returns of \(Y\) is a normal with variance \(\sigma^{2}\), making \(Y\) itself a <a href=/posts/kbhbrownian_motion/>Brownian Motion</a> with center \(0\) and variance \(\sigma^{2}\).</p><p>So now, tackling the expression above in \(X\), we will do the same exact thing as above and divide by \(X\):</p><p>\begin{equation}
\dd{\log X} = \mu \dd{t} + Y\dd{W}
\end{equation}</p><p>So we can see that \(X\) is a <a href=/posts/kbhgeometric_brownian_motion/>Geometric Brownian Motion</a> as a sum of two random variables&mdash;its volatility is determined by \(Y\) with a time-drift \(\mu \dd{t}\).</p><p>We see that we are <em>almost</em> ready to have an analytical solution here, because the top expression is applying some function \(f=\log\) to a stochastic differential equation by time; however, the right side \(Y\) here is not quite a constant (it is itself a stochastic process), so we can&rsquo;t simply apply an <a href=/posts/kbhito_intergral/>It√¥ Intergral</a> and call it a day.</p><p>So instead, we will proceed to a Monte-Carlo simulation of the results to verify as much as we can.</p><p>We will begin by setting the sane values for variances&mdash;having \(0.1\%\) drift and \(1\%\) variance in variance, and the two Brownian motions being inverses of each other \(\rho = 0.5\).</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#111>mu</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.001</span>
</span></span><span style=display:flex><span><span style=color:#111>sigma</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.01</span>
</span></span><span style=display:flex><span><span style=color:#111>rho</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>(</span><span style=color:#111>mu</span><span style=color:#111>,</span><span style=color:#111>sigma</span><span style=color:#111>,</span><span style=color:#111>rho</span><span style=color:#111>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>(0.001, 0.01, 0.5)
</span></span></code></pre></div><p>We will seed a standard Brownian motion; as the two random motions are covariate, we can use the value of one to generate another: therefore we will return both at once.</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> <span style=color:#111>numpy.random</span> <span style=color:#f92672>import</span> <span style=color:#111>normal</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>def</span> <span style=color:#75af00>dbdw</span><span style=color:#111>():</span>
</span></span><span style=display:flex><span>    <span style=color:#111>dB</span> <span style=color:#f92672>=</span> <span style=color:#111>normal</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>    <span style=color:#111>dW</span> <span style=color:#f92672>=</span> <span style=color:#111>dB</span> <span style=color:#f92672>+</span> <span style=color:#111>normal</span><span style=color:#111>(</span><span style=color:#ae81ff>0</span><span style=color:#111>,</span> <span style=color:#111>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span><span style=color:#111>rho</span><span style=color:#111>)</span><span style=color:#f92672>**</span><span style=color:#ae81ff>2</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>return</span> <span style=color:#111>(</span><span style=color:#111>dB</span><span style=color:#111>,</span> <span style=color:#111>dW</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>dbdw</span><span style=color:#111>()</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>(-1.0246010237177643, -1.281335746614678)
</span></span></code></pre></div><p>Excellent.</p><p>We will now simulate the system we were given:</p><p>\begin{equation}
\begin{cases}
\dd{X} = \mu X \dd{t} + XY \dd{W} \\
\dd{Y} = \sigma Y \dd{B}
\end{cases}
\end{equation}</p><p>Let&rsquo;s set the number of trials to \(10000\).</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#111>N</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000</span>
</span></span></code></pre></div><p>We will measure the convergence of \(\bar{\dd{X}}\) and \(\bar{\dd{Y}}\): we will tally each value at each time \(t\) as well as compare their expected values over time.</p><p>We will first seed our systems at \(1\%\) variance and \(1\) dollar of price.</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#111>X</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#111>Y</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.01</span>
</span></span></code></pre></div><p>Now, it&rsquo;s actual simulation time!</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># history of Y and X</span>
</span></span><span style=display:flex><span><span style=color:#111>X_hist</span> <span style=color:#f92672>=</span> <span style=color:#111>[]</span>
</span></span><span style=display:flex><span><span style=color:#111>Y_hist</span> <span style=color:#f92672>=</span> <span style=color:#111>[]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># history of dx</span>
</span></span><span style=display:flex><span><span style=color:#111>dX_hist</span> <span style=color:#f92672>=</span> <span style=color:#111>[]</span>
</span></span><span style=display:flex><span><span style=color:#111>dY_hist</span> <span style=color:#f92672>=</span> <span style=color:#111>[]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># current expected value</span>
</span></span><span style=display:flex><span><span style=color:#111>EdX</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#111>EdY</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># difference in E</span>
</span></span><span style=display:flex><span><span style=color:#111>EdX_diff</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#111>EdY_diff</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># for n loops, we simulate</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>for</span> <span style=color:#111>_</span> <span style=color:#f92672>in</span> <span style=color:#111>range</span><span style=color:#111>(</span><span style=color:#111>N</span><span style=color:#111>):</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># get a source of randmess</span>
</span></span><span style=display:flex><span>    <span style=color:#111>dB</span><span style=color:#111>,</span> <span style=color:#111>dW</span> <span style=color:#f92672>=</span> <span style=color:#111>dbdw</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># get the current dx and dw</span>
</span></span><span style=display:flex><span>    <span style=color:#111>_dX</span> <span style=color:#f92672>=</span> <span style=color:#111>mu</span><span style=color:#f92672>*</span><span style=color:#111>X</span><span style=color:#f92672>+</span><span style=color:#111>X</span><span style=color:#f92672>*</span><span style=color:#111>Y</span><span style=color:#f92672>*</span><span style=color:#111>dW</span>
</span></span><span style=display:flex><span>    <span style=color:#111>_dY</span> <span style=color:#f92672>=</span> <span style=color:#111>sigma</span><span style=color:#f92672>*</span><span style=color:#111>Y</span><span style=color:#f92672>*</span><span style=color:#111>dB</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># apply it</span>
</span></span><span style=display:flex><span>    <span style=color:#111>X</span> <span style=color:#f92672>+=</span> <span style=color:#111>_dX</span>
</span></span><span style=display:flex><span>    <span style=color:#111>Y</span> <span style=color:#f92672>+=</span> <span style=color:#111>_dY</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># tally it</span>
</span></span><span style=display:flex><span>    <span style=color:#111>Y_hist</span><span style=color:#f92672>.</span><span style=color:#111>append</span><span style=color:#111>(</span><span style=color:#111>Y</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>    <span style=color:#111>X_hist</span><span style=color:#f92672>.</span><span style=color:#111>append</span><span style=color:#111>(</span><span style=color:#111>X</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#111>dX_hist</span><span style=color:#f92672>.</span><span style=color:#111>append</span><span style=color:#111>(</span><span style=color:#111>_dX</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>    <span style=color:#111>dY_hist</span><span style=color:#f92672>.</span><span style=color:#111>append</span><span style=color:#111>(</span><span style=color:#111>_dY</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># calculate new expected value</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># we don&#39;t store it immediately b/c we want to check convergence</span>
</span></span><span style=display:flex><span>    <span style=color:#111>_EdX</span> <span style=color:#f92672>=</span> <span style=color:#111>sum</span><span style=color:#111>(</span><span style=color:#111>dX_hist</span><span style=color:#111>)</span><span style=color:#f92672>/</span><span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#111>dX_hist</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>    <span style=color:#111>_EdY</span> <span style=color:#f92672>=</span> <span style=color:#111>sum</span><span style=color:#111>(</span><span style=color:#111>dY_hist</span><span style=color:#111>)</span><span style=color:#f92672>/</span><span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#111>dY_hist</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#111>EdX_diff</span> <span style=color:#f92672>=</span> <span style=color:#111>abs</span><span style=color:#111>(</span><span style=color:#111>_EdX</span><span style=color:#f92672>-</span><span style=color:#111>EdX</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>    <span style=color:#111>EdY_diff</span> <span style=color:#f92672>=</span> <span style=color:#111>abs</span><span style=color:#111>(</span><span style=color:#111>_EdY</span><span style=color:#f92672>-</span><span style=color:#111>EdY</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># store new expected value</span>
</span></span><span style=display:flex><span>    <span style=color:#111>EdX</span> <span style=color:#f92672>=</span> <span style=color:#111>_EdX</span>
</span></span><span style=display:flex><span>    <span style=color:#111>EdY</span> <span style=color:#f92672>=</span> <span style=color:#111>_EdY</span>
</span></span></code></pre></div><p>Let&rsquo;s observe a few values! For starters, let&rsquo;s measure our new expected values.</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#111>EdX</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>0.0013333651336800837
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#111>EdY</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>-1.225482645599256e-06
</span></span></code></pre></div><p>And, let&rsquo;s check if we have converged by seeing if the difference is a reasonably small value:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#111>(</span><span style=color:#111>EdX_diff</span><span style=color:#111>,</span> <span style=color:#111>EdY_diff</span><span style=color:#111>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>(2.578663659035343e-05, 1.2183875816528115e-07)
</span></span></code></pre></div><p>Looks like both of our variables have converged. Now, let&rsquo;s plot a few things. Let&rsquo;s first build a table with our data.</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#111>pandas</span> <span style=color:#00a8c8>as</span> <span style=color:#111>pd</span>
</span></span><span style=display:flex><span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>pd</span><span style=color:#f92672>.</span><span style=color:#111>DataFrame</span><span style=color:#111>({</span><span style=color:#d88200>&#34;price&#34;</span><span style=color:#111>:</span> <span style=color:#111>X_hist</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;variance&#34;</span><span style=color:#111>:</span> <span style=color:#111>Y_hist</span><span style=color:#111>})</span>
</span></span><span style=display:flex><span><span style=color:#111>data</span><span style=color:#111>[</span><span style=color:#d88200>&#34;time&#34;</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>data</span><span style=color:#f92672>.</span><span style=color:#111>index</span>
</span></span><span style=display:flex><span><span style=color:#111>data</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>        price  variance  time
</span></span><span style=display:flex><span>0    0.998644  0.009974     0
</span></span><span style=display:flex><span>1    0.980393  0.009796     1
</span></span><span style=display:flex><span>2    0.998355  0.009967     2
</span></span><span style=display:flex><span>3    0.994514  0.009913     3
</span></span><span style=display:flex><span>4    1.001363  0.009961     4
</span></span><span style=display:flex><span>..        ...       ...   ...
</span></span><span style=display:flex><span>995  2.323640  0.008778   995
</span></span><span style=display:flex><span>996  2.321473  0.008715   996
</span></span><span style=display:flex><span>997  2.343427  0.008818   997
</span></span><span style=display:flex><span>998  2.306271  0.008654   998
</span></span><span style=display:flex><span>999  2.333365  0.008775   999
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[1000 rows x 3 columns]
</span></span></code></pre></div><p>We will use this to continue the rest of our analysis. For data augmentation, we will also calculate the natural logs of the change to get the rate of change.</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#111>numpy</span> <span style=color:#00a8c8>as</span> <span style=color:#111>np</span>
</span></span><span style=display:flex><span><span style=color:#111>data</span><span style=color:#111>[</span><span style=color:#d88200>&#34;price_log&#34;</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>np</span><span style=color:#f92672>.</span><span style=color:#111>log</span><span style=color:#111>(</span><span style=color:#111>data</span><span style=color:#f92672>.</span><span style=color:#111>price</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>data</span><span style=color:#111>[</span><span style=color:#d88200>&#34;variance_log&#34;</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>np</span><span style=color:#f92672>.</span><span style=color:#111>log</span><span style=color:#111>(</span><span style=color:#111>data</span><span style=color:#f92672>.</span><span style=color:#111>variance</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>data</span><span style=color:#111>[</span><span style=color:#d88200>&#34;price_log_change&#34;</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>data</span><span style=color:#f92672>.</span><span style=color:#111>price_log</span> <span style=color:#f92672>-</span> <span style=color:#111>data</span><span style=color:#f92672>.</span><span style=color:#111>price_log</span><span style=color:#f92672>.</span><span style=color:#111>shift</span><span style=color:#111>(</span><span style=color:#ae81ff>1</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>data</span><span style=color:#111>[</span><span style=color:#d88200>&#34;variance_log_change&#34;</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>data</span><span style=color:#f92672>.</span><span style=color:#111>variance_log</span> <span style=color:#f92672>-</span> <span style=color:#111>data</span><span style=color:#f92672>.</span><span style=color:#111>variance_log</span><span style=color:#f92672>.</span><span style=color:#111>shift</span><span style=color:#111>(</span><span style=color:#ae81ff>1</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># drop the first row we have w/o change</span>
</span></span><span style=display:flex><span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>data</span><span style=color:#f92672>.</span><span style=color:#111>dropna</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>data</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>        price  variance  ...  price_log_change  variance_log_change
</span></span><span style=display:flex><span>1    0.980393  0.009796  ...         -0.018444            -0.018005
</span></span><span style=display:flex><span>2    0.998355  0.009967  ...          0.018155             0.017332
</span></span><span style=display:flex><span>3    0.994514  0.009913  ...         -0.003855            -0.005443
</span></span><span style=display:flex><span>4    1.001363  0.009961  ...          0.006863             0.004801
</span></span><span style=display:flex><span>5    0.991306  0.009895  ...         -0.010094            -0.006639
</span></span><span style=display:flex><span>..        ...       ...  ...               ...                  ...
</span></span><span style=display:flex><span>995  2.323640  0.008778  ...          0.002148             0.002124
</span></span><span style=display:flex><span>996  2.321473  0.008715  ...         -0.000933            -0.007227
</span></span><span style=display:flex><span>997  2.343427  0.008818  ...          0.009413             0.011765
</span></span><span style=display:flex><span>998  2.306271  0.008654  ...         -0.015983            -0.018804
</span></span><span style=display:flex><span>999  2.333365  0.008775  ...          0.011680             0.013827
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[999 rows x 7 columns]
</span></span></code></pre></div><p>Let&rsquo;s begin by plotting what we have:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#111>seaborn</span> <span style=color:#00a8c8>as</span> <span style=color:#111>sns</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#111>matplotlib.pyplot</span> <span style=color:#00a8c8>as</span> <span style=color:#111>plt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>sns</span><span style=color:#f92672>.</span><span style=color:#111>set</span><span style=color:#111>()</span>
</span></span></code></pre></div><p>We will plot price and variation on two axes.</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#111>plt</span><span style=color:#f92672>.</span><span style=color:#111>gcf</span><span style=color:#111>()</span><span style=color:#f92672>.</span><span style=color:#111>clear</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>sns</span><span style=color:#f92672>.</span><span style=color:#111>lineplot</span><span style=color:#111>(</span><span style=color:#111>x</span><span style=color:#f92672>=</span><span style=color:#111>data</span><span style=color:#f92672>.</span><span style=color:#111>time</span><span style=color:#111>,</span> <span style=color:#111>y</span><span style=color:#f92672>=</span><span style=color:#111>data</span><span style=color:#f92672>.</span><span style=color:#111>price</span><span style=color:#111>,</span> <span style=color:#111>color</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;g&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>ax2</span> <span style=color:#f92672>=</span> <span style=color:#111>plt</span><span style=color:#f92672>.</span><span style=color:#111>twinx</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>sns</span><span style=color:#f92672>.</span><span style=color:#111>lineplot</span><span style=color:#111>(</span><span style=color:#111>x</span><span style=color:#f92672>=</span><span style=color:#111>data</span><span style=color:#f92672>.</span><span style=color:#111>time</span><span style=color:#111>,</span> <span style=color:#111>y</span><span style=color:#f92672>=</span><span style=color:#111>data</span><span style=color:#f92672>.</span><span style=color:#111>variance</span><span style=color:#111>,</span> <span style=color:#111>color</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;b&#34;</span><span style=color:#111>,</span> <span style=color:#111>ax</span><span style=color:#f92672>=</span><span style=color:#111>ax2</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>plt</span><span style=color:#f92672>.</span><span style=color:#111>show</span><span style=color:#111>()</span>
</span></span></code></pre></div><figure><img src=/ox-hugo/2022-10-14_22-09-05_screenshot.png></figure><p>Where, the blue line represents the percent variance over time and the green line represents the price. Given the \(0.1\%\) drift we provided, we can see that our simulated market grows steadily in the 1000 data point.</p><p>We can then plot the log (percent) changes.</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#111>plt</span><span style=color:#f92672>.</span><span style=color:#111>gcf</span><span style=color:#111>()</span><span style=color:#f92672>.</span><span style=color:#111>clear</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>sns</span><span style=color:#f92672>.</span><span style=color:#111>lineplot</span><span style=color:#111>(</span><span style=color:#111>x</span><span style=color:#f92672>=</span><span style=color:#111>data</span><span style=color:#f92672>.</span><span style=color:#111>time</span><span style=color:#111>,</span> <span style=color:#111>y</span><span style=color:#f92672>=</span><span style=color:#111>data</span><span style=color:#f92672>.</span><span style=color:#111>price_log_change</span><span style=color:#111>,</span> <span style=color:#111>color</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;g&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>ax2</span> <span style=color:#f92672>=</span> <span style=color:#111>plt</span><span style=color:#f92672>.</span><span style=color:#111>twinx</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>sns</span><span style=color:#f92672>.</span><span style=color:#111>lineplot</span><span style=color:#111>(</span><span style=color:#111>x</span><span style=color:#f92672>=</span><span style=color:#111>data</span><span style=color:#f92672>.</span><span style=color:#111>time</span><span style=color:#111>,</span> <span style=color:#111>y</span><span style=color:#f92672>=</span><span style=color:#111>data</span><span style=color:#f92672>.</span><span style=color:#111>variance_log_change</span><span style=color:#111>,</span> <span style=color:#111>color</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;b&#34;</span><span style=color:#111>,</span> <span style=color:#111>ax</span><span style=color:#f92672>=</span><span style=color:#111>ax2</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>plt</span><span style=color:#f92672>.</span><span style=color:#111>show</span><span style=color:#111>()</span>
</span></span></code></pre></div><figure><img src=/ox-hugo/2022-10-14_22-19-02_screenshot.png></figure><p>As you can see&mdash;we have fairly strong random variables, centered around \(0\). Having verified that our drift and variables behave in the way that we expect, we can proceed with analysis.</p><p>We can use a single-variable \(t\) test to figure the \(99\%\) confidence band of the result. To do this, we first need to calculate the mean and standardized deviation of the price percent change (log difference).</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#111>log_mean</span><span style=color:#111>,</span> <span style=color:#111>log_std</span> <span style=color:#f92672>=</span> <span style=color:#111>(</span><span style=color:#111>data</span><span style=color:#f92672>.</span><span style=color:#111>price_log_change</span><span style=color:#f92672>.</span><span style=color:#111>mean</span><span style=color:#111>(),</span> <span style=color:#111>data</span><span style=color:#f92672>.</span><span style=color:#111>price_log_change</span><span style=color:#f92672>.</span><span style=color:#111>std</span><span style=color:#111>())</span>
</span></span><span style=display:flex><span><span style=color:#111>(</span><span style=color:#111>log_mean</span><span style=color:#111>,</span> <span style=color:#111>log_std</span><span style=color:#111>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>(0.0008495184126335735, 0.008471735971085885)
</span></span></code></pre></div><p>And now, we will calculate the</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> <span style=color:#111>scipy.stats</span> <span style=color:#f92672>import</span> <span style=color:#111>t</span>
</span></span><span style=display:flex><span><span style=color:#111>lower_bound</span><span style=color:#111>,</span> <span style=color:#111>upper_bound</span> <span style=color:#f92672>=</span> <span style=color:#111>t</span><span style=color:#f92672>.</span><span style=color:#111>interval</span><span style=color:#111>(</span><span style=color:#ae81ff>0.99</span><span style=color:#111>,</span> <span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#111>data</span><span style=color:#111>)</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>,</span> <span style=color:#111>loc</span><span style=color:#f92672>=</span><span style=color:#111>log_mean</span><span style=color:#111>,</span> <span style=color:#111>scale</span><span style=color:#f92672>=</span><span style=color:#111>log_std</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>lower_bound</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>-0.021014037766751738
</span></span></code></pre></div><p>Therefore, with \(99\%\) confidence, we can say that our asset&mdash;given its current parameters, and an \(N=1000\) Monte-Carlo simulation&mdash;will not have a more than \(2.1\%\) drop in value.</p><p>We will use a hedged option to minimize loss. We will use this value to determine the maximum loss for an European put option, maturing in \(T\) time, such that the exercise thereof will be hedged against drops of asset price.</p><p>First, we will determine the cost of a correctly hedged European put option.</p><p>We will define \(S_{0}\) as the current price of the asset. We will use \(P\) as the price of the put option.</p><p>We desire the strike price of the option to be:</p><p>\begin{equation}
K = S_{0} + P
\end{equation}</p><p>that is: the price of the put option we desire here will recuperate the price to trade the option <em>and</em> protect against loss. We will symbolically solve for the price of such an option.</p><p>Note that the codeblocks switches here from standard Python to SageMath.</p><p>We first define the standard normal cumulative distribution.</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sage data-lang=sage><span style=display:flex><span><span style=color:#f92672>from</span> <span style=color:#111>sage.symbolic.integration.integral</span> <span style=color:#f92672>import</span> <span style=color:#111>definite_integral</span>
</span></span><span style=display:flex><span><span style=color:#111>z</span> <span style=color:#f92672>=</span> <span style=color:#111>var</span><span style=color:#111>(</span><span style=color:#d88200>&#34;z&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>N</span><span style=color:#111>(</span><span style=color:#111>x</span><span style=color:#111>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#111>sqrt</span><span style=color:#111>(</span><span style=color:#ae81ff>2</span><span style=color:#f92672>*</span><span style=color:#111>pi</span><span style=color:#111>)</span><span style=color:#f92672>*</span><span style=color:#111>definite_integral</span><span style=color:#111>(</span><span style=color:#111>e</span><span style=color:#f92672>^</span><span style=color:#111>(</span><span style=color:#f92672>-</span><span style=color:#111>z</span><span style=color:#f92672>^</span><span style=color:#ae81ff>2</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span><span style=color:#111>),</span> <span style=color:#111>z</span><span style=color:#111>,</span> <span style=color:#f92672>-</span><span style=color:#111>infinity</span><span style=color:#111>,</span> <span style=color:#111>x</span><span style=color:#111>)</span>
</span></span></code></pre></div><p>We will then leverage the Euopean call Black-Scholes model to calculate the optimal put price. We first instantiate variables \(T\), and we will set current time to be \(0\).</p><p>We will use \(v\) for \(\sigma\), the volatility of the security. We will use \(S\) for current price. Lastly, we define \(P\) to be our put price. We will call \(r\) our risk-free rate.</p><p>To determine the discount factor, we first implement symbolically our expression for desired strike price.</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sage data-lang=sage><span style=display:flex><span><span style=color:#111>v</span><span style=color:#111>,</span><span style=color:#111>T</span><span style=color:#111>,</span><span style=color:#111>S</span><span style=color:#111>,</span><span style=color:#111>P</span><span style=color:#111>,</span><span style=color:#111>r</span> <span style=color:#f92672>=</span> <span style=color:#111>var</span><span style=color:#111>(</span><span style=color:#d88200>&#34;v T S P r&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>K</span> <span style=color:#f92672>=</span> <span style=color:#111>S</span><span style=color:#f92672>+</span><span style=color:#111>P</span>
</span></span><span style=display:flex><span><span style=color:#111>K</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>P + S
</span></span></code></pre></div><p>Great. Now we will implement our discount factors.</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sage data-lang=sage><span style=display:flex><span><span style=color:#111>d1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#111>v</span><span style=color:#f92672>*</span><span style=color:#111>sqrt</span><span style=color:#111>(</span><span style=color:#111>T</span><span style=color:#111>)</span> <span style=color:#f92672>*</span> <span style=color:#111>(</span><span style=color:#111>ln</span><span style=color:#111>(</span><span style=color:#111>S</span><span style=color:#f92672>/</span><span style=color:#111>K</span><span style=color:#111>)</span> <span style=color:#f92672>+</span> <span style=color:#111>(</span><span style=color:#111>r</span><span style=color:#f92672>+</span><span style=color:#111>v</span><span style=color:#f92672>^</span><span style=color:#ae81ff>2</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span><span style=color:#111>)</span><span style=color:#f92672>*</span><span style=color:#111>(</span><span style=color:#111>T</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span><span style=color:#111>d2</span> <span style=color:#f92672>=</span> <span style=color:#111>d1</span><span style=color:#f92672>-</span><span style=color:#111>v</span><span style=color:#f92672>*</span><span style=color:#111>T</span>
</span></span><span style=display:flex><span><span style=color:#111>d1</span><span style=color:#111>,</span> <span style=color:#111>d2</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>(1/2*((v^2 + 2*r)*T + 2*log(S/(P + S)))*sqrt(T)/v,
</span></span><span style=display:flex><span> -T*v + 1/2*((v^2 + 2*r)*T + 2*log(S/(P + S)))*sqrt(T)/v)
</span></span></code></pre></div><p>And lastly, we will implement the Black-Scholes expression for puts as a logical expression.</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sage data-lang=sage><span style=display:flex><span><span style=color:#111>expr</span> <span style=color:#f92672>=</span> <span style=color:#111>P</span> <span style=color:#f92672>==</span> <span style=color:#111>N</span><span style=color:#111>(</span><span style=color:#f92672>-</span><span style=color:#111>d2</span><span style=color:#111>)</span><span style=color:#f92672>*</span><span style=color:#111>K</span><span style=color:#f92672>*</span><span style=color:#111>e</span><span style=color:#f92672>^</span><span style=color:#111>(</span><span style=color:#f92672>-</span><span style=color:#111>r</span><span style=color:#f92672>*</span><span style=color:#111>T</span><span style=color:#111>)</span><span style=color:#f92672>-</span><span style=color:#111>N</span><span style=color:#111>(</span><span style=color:#f92672>-</span><span style=color:#111>d1</span><span style=color:#111>)</span><span style=color:#f92672>*</span><span style=color:#111>S</span>
</span></span><span style=display:flex><span><span style=color:#111>expr</span>
</span></span></code></pre></div><p>\begin{equation}
P = \frac{{\left({\left(\operatorname{erf}\left(\frac{\sqrt{2} {\left(T v^{2} + 2 \, T r + 2 \, \log\left(\frac{S}{P + S}\right)\right)} \sqrt{T}}{4 \, v}\right) - 1\right)} e^{\left(T r\right)} - \operatorname{erf}\left(-\frac{\sqrt{2} {\left(2 \, T v^{2} - {\left(T v^{2} + 2 \, T r + 2 \, \log\left(\frac{S}{P + S}\right)\right)} \sqrt{T}\right)}}{4 \, v}\right) + 1\right)} S}{\operatorname{erf}\left(-\frac{\sqrt{2} {\left(2 \, T v^{2} - {\left(T v^{2} + 2 \, T r + 2 \, \log\left(\frac{S}{P + S}\right)\right)} \sqrt{T}\right)}}{4 \, v}\right) + 2 \, e^{\left(T r\right)} - 1}
\end{equation}</p><p>Numerical solutions to this expression&mdash;fitting for each of the values from before&mdash;would then indicate the correct price of the option to generate the hedging effect desired.</p></div></article></main><footer style=margin-top:20px><p id=footer style=font-size:8px;color:var(--gray-3)>&copy; 2019-2025 Houjun Liu. Licensed CC BY-NC-SA 4.0.</p></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.32.2/tocbot.min.js></script><script>tocbot.init({tocSelector:"#toc",contentSelector:".center-clearfix",headingSelector:"h1, h2, h3",hasInnerContainers:!0})</script></body></html>