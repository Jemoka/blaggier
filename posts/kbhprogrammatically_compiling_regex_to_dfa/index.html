<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin=anonymous></script><meta name=viewport content="width=device-width,initial-scale=1"><script src=https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4></script><link rel=preconnect href=https://fonts.bunny.net><link href="https://fonts.bunny.net/css?family=ibm-plex-sans:300,400,400i,500,500i,600,700,700i" rel=stylesheet><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script>window.MathJax={loader:{load:["[tex]/physics"]},tex:{packages:{"[+]":["physics"]}}}</script><title>programatically compiling RegEx to DFA</title>
<meta name=description content="A high level sketch:



Another High Level Sketch
Step 1: Write some RegExps
Do that.
Step 2: Construct R
For regular expressions you have defined for keywords, identifies, numbers, etc&mldr; We want to construct an uber union regular expression:
\begin{align}
R &= \text{Keyword} + \text{Identifier} + \text{Number} + \dots   \\
&= R_1 | R_2 | R_3 | \dots
\end{align}
Step 3: Tokenization
For input \(x_1, &mldr;, x_{n}\), for \(i \in 1 &mldr;n\) inclusive, we check:"><meta name=author content="Houjun Liu"><link rel=stylesheet href=/css/all.css><link rel=stylesheet href=/css/page.css><link rel=stylesheet href=/css/syntax.css><link rel=stylesheet href=/css/typography.css><link rel=stylesheet href=/css/components.css></head><body><div class="center-clearfix p-10" style="max-width:1200px;margin:0 auto"><header class=pb-4><span class="w-full flex justify-between flex-wrap"><div style=font-weight:600;font-size:15px><a style=border:0;cursor:pointer href=/><img src=/images/Logo_Transparent.png style=width:17px;display:inline-block;margin-right:8px;transform:translateY(-2.7px)></a>programatically compiling RegEx to DFA</div><span style="float:right;display:flex;align-items:center;margin-top:5px;width:100%;max-width:400px;background:#fff;border-radius:2px;border:1px solid var(--gray-2);position:relative"><i class="fa-solid fa-magnifying-glass" style=font-size:12px;color:var(--yellow-fg);margin-right:7px;margin-left:10px></i><div style=width:100%><input id=search-query-inline name=s type=text autocomplete=off placeholder="Search Knowledgebase" enterkeyhint=search></div><div id=search-result-inline style=display:none></div><script id=search-result-template type=text/x-js-template data-template=searchresult>
    <a href="${link}" class="search-link">
    <div class="search-result-item" id="search-result-item-${key}">
        <div class="search-result-title">${title}</div>
        <div class="search-result-summary">${snippet}</div>
    </div>
    </a>
</script><script src=https://code.jquery.com/jquery-3.3.1.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.0/fuse.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js></script><script type=module>
    import { create, insertMultiple, search } from 'https://cdn.jsdelivr.net/npm/@orama/orama@latest/+esm'
    let template = $('script[data-template="searchresult"]').text().split(/\$\{(.+?)\}/g);

    function render(props) {
        return function(tok, i) { return (i % 2) ? props[tok] : tok; };
    }

    const db = create({
        schema: {
            title: 'string',
            content: 'string',
        },
    });
    $.get("https://www.jemoka.com/index.json", function(data, status){
        insertMultiple(db, data.map(x =>
            ({title: x.title, content: x.contents, link: x.permalink})));
    });
    $("#search-result-inline").attr("tabindex", "-1");
    $(document).on("click", function (e) {
    if (!$(e.target).closest("#search-query-inline, #search-result-inline").length) {
        $("#search-result-inline").hide();
    }
    });
    
    
    
    
    
    

    $("#search-query-inline").on("focus keyup", function () {
        let value = $(this).val();
        if (value.trim() == "") {
            $("#search-result-inline").html("");
            $("#search-result-inline").hide();
            return;
        }
        $("#search-result-inline").show();
        let results = search(db, {mode: "fulltext", term: value});
        let contents = results.hits.map(x => template.map(render({
            title: x.document.title,
            snippet: x.document.content.slice(0, 52),
            key: x.id,
            link: x.document.link
        })).join(''));
        $("#search-result-inline").html(contents.join("\n"));
        
    });
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
        $('#search-query-inline').on('focus', function(){
            
            $(this).data('fontSize', $(this).css('font-size')).css('font-size', '16px');
        }).on('blur', function(){
            
            $(this).css('font-size', $(this).data('fontSize'));
        });
    }

</script></span></span><div class=w-full style="padding-bottom:4px;border-bottom:1px solid var(--gray-1);margin-top:1px"></div></header><aside id=tocbox><div id=heading style=padding-left:40px;font-weight:600;font-size:11px;color:var(--gray-3)>contents</div><div id=toc></div></aside><main><article><div style=max-width:700px><p>A high level sketch:</p><figure><img src=/ox-hugo/compiling_regexp.svg></figure><h2 id=another-high-level-sketch>Another High Level Sketch</h2><h3 id=step-1-write-some-regexps>Step 1: Write some RegExps</h3><p>Do that.</p><h3 id=step-2-construct-r>Step 2: Construct R</h3><p>For regular expressions you have defined for keywords, identifies, numbers, etc&mldr; We want to construct an uber union regular expression:</p><p>\begin{align}
R &= \text{Keyword} + \text{Identifier} + \text{Number} + \dots \\
&= R_1 | R_2 | R_3 | \dots
\end{align}</p><h3 id=step-3-tokenization>Step 3: Tokenization</h3><p>For input \(x_1, &mldr;, x_{n}\), for \(i \in 1 &mldr;n\) inclusive, we check:</p><p>\begin{equation}
x_1 \dots x_{i} \stackrel{?}{\in} L\qty( R)
\end{equation}</p><p>Upon success for some \(i\), we know that \(x_{1}, &mldr;, x_{i} \in L\qty(R_{j})\) for some \(j\). We can then send \(x_1, &mldr;, x_{i}\) to the parser and then continue lexing for input \(x_{i+1}&mldr;x_{n}\).</p><h4 id=ambiguity>ambiguity</h4><ul><li><strong>multiple matches, different lengths</strong>: we pick the longest possible substring</li><li><strong>multiple matches, same length</strong>: pick the first rule</li><li><strong>nothing matches</strong>: we just put a catch all rule in the bottom</li></ul><h2 id=how-exactly-does-matching-mean>How exactly does &ldquo;matching&rdquo; mean?</h2><p><a href=/posts/kbhdeterministic_finite_automata/>DFA</a>s, <a href=/posts/kbhnondeterministic_finite_automata/>NFA</a>s, <a href=/posts/kbhnondeterministic_finite_automata/#id-4f5a240b-565b-4341-ab32-0b8b4540103f-dfa-s-are-equivalent-to-id-5520de84-0c82-4b31-97cb-51f7de4652dc-nfa-s>subset construction</a>! Conventions used in this class:</p><ul><li>\(\Sigma\) alphabet</li><li>\(S\) states</li><li>\(n\) start</li><li>\(F \subseteq S\) accepting states</li><li>\(S \to^{x} S\) transition</li></ul><p>and recall <a href=/posts/kbhregular_expression_complexity/#regular-expressions-are-equivalent-to-regular-languages>regular expressions are equivalent to regular languages</a>. When you attempt to take a transition that doesn&rsquo;t exist in NFAs, you end into nothing.</p><h3 id=algorithm-for-casting-regexp-to-nfa>algorithm for casting RegExp to NFA</h3><p>By convention every NFA will have a single starting state and a single ending state. We will then compose every composition&rsquo;s machine together.</p><h4 id=concatenation>concatenation</h4><p>For parser of \(A\) and \(B\), we compose them by composing the accept state of \(A\) with an \(\epsilon\) move to \(B\), and make \(A\) no longer an accepting state.</p><figure><img src=/ox-hugo/2025-04-10_11-29-39_screenshot.png></figure><h4 id=union>union</h4><p>We make an epsilon move from the starting state to both \(A\) and \(B\). And then when you hit the accepting state of either \(A\) or \(B\) you epsilon move to the accepting state.</p><figure><img src=/ox-hugo/2025-04-10_11-29-32_screenshot.png></figure><h4 id=kleene-star>kleene star</h4><figure><img src=/ox-hugo/2025-04-10_11-29-27_screenshot.png></figure><h3 id=implementing-dfas-as-a-table>implementing DFAs as a table</h3><ul><li>columns: alphabet</li><li>rows: states</li></ul><p>the way you implement this is to just look up the (state, symbol) pair, take the transition, and look up the new state, symbol, etc.</p><table><thead><tr><th></th><th>0</th><th>1</th></tr></thead><tbody><tr><td>a</td><td>a</td><td>b</td></tr><tr><td>b</td><td>a</td><td>b</td></tr></tbody></table><p>is</p><figure><img src=/ox-hugo/2025-04-10_11-47-48_screenshot.png></figure><p>and so on. To construct this table, you just read off the transition function.</p></div></article></main><footer style=margin-top:20px><p id=footer style=font-size:8px;color:var(--gray-3)>&copy; 2019-2025 Houjun Liu. Licensed CC BY-NC-SA 4.0.</p></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.32.2/tocbot.min.js></script><script>tocbot.init({tocSelector:"#toc",contentSelector:".center-clearfix",headingSelector:"h1, h2, h3",hasInnerContainers:!0})</script></body></html>