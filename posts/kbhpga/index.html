<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin=anonymous></script><meta name=viewport content="width=device-width,initial-scale=1"><script src=https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4></script><link rel=preconnect href=https://fonts.bunny.net><link href="https://fonts.bunny.net/css?family=ibm-plex-sans:300,400,400i,500,500i,600,700,700i" rel=stylesheet><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script>window.MathJax={loader:{load:["[tex]/physics"]},tex:{packages:{"[+]":["physics"]}}}</script><title>PGA</title>
<meta name=description content="PGA extends controller gradient ascent to cover CPOMDPs
Notation
Recall from controller gradient ascent we have an objective which we will modify for CPOMDPs. For initial controller-states \(\beta\) and utility \(\bold{u}_{\theta}\):
\begin{equation}
\max_{\theta}\ \beta^{\top} (\bold{I} - \gamma \bold{T}_{\theta})^{-1} \bold{r}_{\theta}
\end{equation}
subject to:

\(\Psi\) remains a probably distribution over \(|A|\)
\(\eta\) remains a probably distribution over \(|X|\)
and, new for CPOMDP, \(\beta^{\top} (\bold{I} - \gamma \bold{T}_{\theta})^{-1} C_{i} \leq \epsilon_{i}\ \forall i\), that is, each constraint \(C_{i} \in \bold{C}_{i}\) is satisfied to be lower than the budget \(\epsilon_{i}\).

where"><meta name=author content="Houjun Liu"><link rel=stylesheet href=/css/all.css><link rel=stylesheet href=/css/page.css><link rel=stylesheet href=/css/syntax.css><link rel=stylesheet href=/css/typography.css><link rel=stylesheet href=/css/components.css></head><body><div class="center-clearfix p-10" style="max-width:1200px;margin:0 auto"><header class=pb-4><span class="w-full flex justify-between flex-wrap"><div style=font-weight:600;font-size:15px><a style=border:0;cursor:pointer href=/><img src=/images/Logo_Transparent.png style=width:17px;display:inline-block;margin-right:8px;transform:translateY(-2.7px)></a>PGA</div><span style="float:right;display:flex;align-items:center;margin-top:5px;width:100%;max-width:400px;background:#fff;border-radius:2px;border:1px solid var(--gray-2);position:relative"><i class="fa-solid fa-magnifying-glass" style=font-size:12px;color:var(--yellow-fg);margin-right:7px;margin-left:10px></i><div style=width:100%><input id=search-query-inline name=s type=text autocomplete=off placeholder="Search Knowledgebase" enterkeyhint=search></div><div id=search-result-inline style=display:none></div><script id=search-result-template type=text/x-js-template data-template=searchresult>
    <a href="${link}" class="search-link">
    <div class="search-result-item" id="search-result-item-${key}">
        <div class="search-result-title">${title}</div>
        <div class="search-result-summary">${snippet}</div>
    </div>
    </a>
</script><script src=https://code.jquery.com/jquery-3.3.1.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.0/fuse.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js></script><script type=module>
    import { create, insertMultiple, search } from 'https://cdn.jsdelivr.net/npm/@orama/orama@latest/+esm'
    let template = $('script[data-template="searchresult"]').text().split(/\$\{(.+?)\}/g);

    function render(props) {
        return function(tok, i) { return (i % 2) ? props[tok] : tok; };
    }

    const db = create({
        schema: {
            title: 'string',
            content: 'string',
        },
    });
    $.get("https://www.jemoka.com/index.json", function(data, status){
        insertMultiple(db, data.map(x =>
            ({title: x.title, content: x.contents, link: x.permalink})));
    });
    $("#search-result-inline").attr("tabindex", "-1");
    $(document).on("click", function (e) {
    if (!$(e.target).closest("#search-query-inline, #search-result-inline").length) {
        $("#search-result-inline").hide();
    }
    });
    
    
    
    
    
    

    $("#search-query-inline").on("focus keyup", function () {
        let value = $(this).val();
        if (value.trim() == "") {
            $("#search-result-inline").html("");
            $("#search-result-inline").hide();
            return;
        }
        $("#search-result-inline").show();
        let results = search(db, {mode: "fulltext", term: value});
        let contents = results.hits.map(x => template.map(render({
            title: x.document.title,
            snippet: x.document.content.slice(0, 52),
            key: x.id,
            link: x.document.link
        })).join(''));
        $("#search-result-inline").html(contents.join("\n"));
        
    });
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
        $('#search-query-inline').on('focus', function(){
            
            $(this).data('fontSize', $(this).css('font-size')).css('font-size', '16px');
        }).on('blur', function(){
            
            $(this).css('font-size', $(this).data('fontSize'));
        });
    }

</script></span></span><div class=w-full style="padding-bottom:4px;border-bottom:1px solid var(--gray-1);margin-top:1px"></div></header><aside id=tocbox><div id=heading style=padding-left:40px;font-weight:600;font-size:11px;color:var(--gray-3)>contents</div><div id=toc></div></aside><main><article><div style=max-width:700px><p><a href=/posts/kbhpga/>PGA</a> extends <a href=/posts/kbhcontroller_gradient_ascent/>controller gradient ascent</a> to cover <a href=/posts/kbhcpomdp/>CPOMDPs</a></p><h2 id=notation>Notation</h2><p>Recall from <a href=/posts/kbhcontroller_gradient_ascent/>controller gradient ascent</a> we have an objective which we will modify for <a href=/posts/kbhcpomdp/>CPOMDP</a>s. For initial controller-states \(\beta\) and utility \(\bold{u}_{\theta}\):</p><p>\begin{equation}
\max_{\theta}\ \beta^{\top} (\bold{I} - \gamma \bold{T}_{\theta})^{-1} \bold{r}_{\theta}
\end{equation}</p><p>subject to:</p><ul><li>\(\Psi\) remains a probably distribution over \(|A|\)</li><li>\(\eta\) remains a probably distribution over \(|X|\)</li><li>and, new for <a href=/posts/kbhcpomdp/>CPOMDP</a>, \(\beta^{\top} (\bold{I} - \gamma \bold{T}_{\theta})^{-1} C_{i} \leq \epsilon_{i}\ \forall i\), that is, each constraint \(C_{i} \in \bold{C}_{i}\) is satisfied to be lower than the budget \(\epsilon_{i}\).</li></ul><p>where</p><p>\begin{equation}
T_{\theta}((x,s), (x&rsquo;,s&rsquo;)) = \sum_{a} \Psi(a | x) T(s&rsquo;|s,a) \sum_{o} O (o|a,s&rsquo;) \eta (x&rsquo;|x,a,o)
\end{equation}</p><p>and</p><p>\begin{equation}
R_{\theta}((x, s)) = \sum_{a} \Psi(a|x) R(s,a)
\end{equation}</p><p>in which</p><ul><li>\(X\): a set of nodes (hidden, internal states)</li><li>\(\Psi(a|x)\): probability of taking an action</li><li>\(\eta(x&rsquo;|x,a,o)\) : transition probability between hidden states</li></ul><h2 id=optimization-formulation>Optimization Formulation</h2><p>we formulate policy parameters \(\theta\) as a large stacked vector of the shape:</p><p>\begin{equation}
\theta = \mqty(\Psi(a_0 | x_0) \\ \Psi(a_1 | x_0) \\ \dots \\ \Psi(a_n | x_N) \\ \eta(x_0 | x_0, a_0, o_0) \\ \eta(x_1 | x_0, a_0, o_0) \\ \dots \\ \eta(x_N | x_N, a_n, o_f))
\end{equation}</p><p>Let us define block diagonal matricies \(J_{\Psi}\) and \(J_{\eta}\), whereby:</p><p>\begin{equation}
J_{\Psi} = \mqty(\bold{1}_{\Psi}^{\top} & \dots & \bold{0} \\ & \dots & \\ \bold{0} & \dots &\bold{1}_{\Psi}^{\top} )
\end{equation}</p><p>where \(J_{\Psi} \in \mathbb{R}^{|X| \times (|A| \times |X|)}\) and each block part \(\bold{1}_{\Psi} \in \mathbb{R}^{|A|}\) represents a one-vector of length of the action space. You can see how multiplying a vector \(\qty[\Psi(a_0|x_0) \\ \dots \\ \Psi(a_n|x_N)]\) against this matrix should yield a \(1\) vector if each \(\Psi(\cdot | x_{i})\) is a probability distribution.</p><p>Similar, we define, \(J_{\eta}\) in a similar fashion to add the distributions over each \(\eta(\cdot | x, a, o)\).</p><p>This yields another block-block matrix</p><p>\begin{equation}
J = \mqty(J_{\Psi} & 0 \\ 0 & J_{\eta})
\end{equation}</p><p>for which we desire \(J\theta = 1\) in order to verify that the probability distributions are valid.</p><p>Lastly, let us define \(\bold{Z} = (\bold{I} - \gamma \bold{T}_{\theta})\). For ease of notation in constructing this result, we declare:</p><p>\begin{equation}
f(\theta) = \beta^{\top} \bold{Z}^{-1} \bold{r}_{\theta}
\end{equation}</p><p>and</p><p>\begin{equation}
h_{i}(\theta) = \beta^{\top} \bold{Z}^{-1} C_{i}
\end{equation}</p><p>Finally, this allows us to formulate the problem as a nonlinear optimization problem:</p><p>\begin{align}
\max_{\theta}\ &amp;f(\theta) \\
\text{such that}\ &amp;J\theta = 1 \\
& \theta \geq 0 \\
& h_{i}(\theta) \leq \epsilon_{i},\ \forall i
\end{align}</p><h2 id=gradient-ascent-procedure>Gradient Ascent Procedure</h2><p>Note that the initial state information \(\beta\) is constant. Therefore, the gradient of the top expression against each field in \(\theta\) becomes, via an rearrangement of the chain rule:</p><p>\begin{equation}
\pdv{f(\theta)}{\theta_{i}} = \beta^{\top} \qty[\bold{Z}^{-1} \qty( \pdv{\bold{r}_{\theta}}{\theta_{i}} + \pdv{\bold{Z}}{\theta_{i}} \bold{Z}^{-1}\bold{r}_{\theta})]
\end{equation}</p><p>The derivatives of each \(\theta\) against each \(\bold{r}\) and \(\bold{Z}\) is given on pp 485 of Alg4DM.</p><p>As with all gradient ascent cases, each &ldquo;step&rdquo; takes the rough form of</p><p>\begin{equation}
\xi = \theta + \alpha \nabla_{\theta} f(\theta)
\end{equation}</p><p>however, in this implementation, the step size isn&rsquo;t actually fixed. Instead, we do&mldr;</p><h3 id=golden-section-line-search>Golden Section Line Search</h3><p>Instead of taking fixed-step sizes to get to the maxima, <a href=/posts/kbhpga/>PGA</a> proposes <a href=#golden-section-line-search>Golden Section Line Search</a> as a line-search algorithm to dynamically choose the steps to get to maxima.</p><p>Line search algorithms are typically computationally heavy as it requires evaluating the relative utility (i.e. here \(\bold{Z}^{-1} \bold{r}_{\theta}\)) a lot of times, which is computationally intractable.</p><p>So, <a href=#golden-section-line-search>Golden Section Line Search</a> uses a divide-and-conquer method via the golden ratio to address this issue.</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#00a8c8>def</span> <span style=color:#75af00>optimize</span><span style=color:#960050;background-color:#1e0010>!</span><span style=color:#111>(</span><span style=color:#111>CPOMDP</span><span style=color:#111>,</span> <span style=color:#111>phi</span><span style=color:#f92672>=</span><span style=color:#111>golden_ratio</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>              <span style=color:#111>gamma</span><span style=color:#f92672>=</span><span style=color:#111>discount_factor</span><span style=color:#111>,</span> <span style=color:#111>eps</span><span style=color:#f92672>=</span><span style=color:#111>minimum_boundary</span><span style=color:#111>):</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># C-POMDP Spec</span>
</span></span><span style=display:flex><span>    <span style=color:#111>f</span> <span style=color:#f92672>=</span> <span style=color:#111>CPOMDP</span><span style=color:#f92672>.</span><span style=color:#111>objective_function</span> <span style=color:#75715e># this is f(theta)</span>
</span></span><span style=display:flex><span>    <span style=color:#111>T</span> <span style=color:#f92672>=</span> <span style=color:#111>CPOMDP</span><span style=color:#f92672>.</span><span style=color:#111>transition_matrix</span>
</span></span><span style=display:flex><span>    <span style=color:#111>R</span> <span style=color:#f92672>=</span> <span style=color:#111>CPOMDP</span><span style=color:#f92672>.</span><span style=color:#111>reward_vector</span>
</span></span><span style=display:flex><span>    <span style=color:#111>b</span> <span style=color:#f92672>=</span> <span style=color:#111>CPOMDP</span><span style=color:#f92672>.</span><span style=color:#111>initial_state_vector</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># as obtained above</span>
</span></span><span style=display:flex><span>    <span style=color:#111>nabla</span> <span style=color:#f92672>=</span> <span style=color:#111>f</span><span style=color:#111>(</span><span style=color:#111>theta</span><span style=color:#111>)</span><span style=color:#f92672>.</span><span style=color:#111>grad</span><span style=color:#111>(</span><span style=color:#111>theta</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># initialize the search bounds based on splitting</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># search space (full step, no step) via the golden ratio</span>
</span></span><span style=display:flex><span>    <span style=color:#111>a1</span><span style=color:#111>,</span> <span style=color:#111>a2</span><span style=color:#111>,</span> <span style=color:#111>a3</span><span style=color:#111>,</span> <span style=color:#111>a4</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#111>,</span> <span style=color:#111>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span><span style=color:#111>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#111>phi</span><span style=color:#111>)),</span> <span style=color:#111>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#111>phi</span><span style=color:#111>),</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># calculate new policies and their utilities</span>
</span></span><span style=display:flex><span>    <span style=color:#111>theta2</span><span style=color:#111>,</span> <span style=color:#111>theta3</span> <span style=color:#f92672>=</span> <span style=color:#111>theta</span> <span style=color:#f92672>+</span> <span style=color:#111>a2</span><span style=color:#f92672>*</span><span style=color:#111>nabla</span><span style=color:#111>,</span> <span style=color:#111>theta</span> <span style=color:#f92672>+</span> <span style=color:#111>a3</span><span style=color:#f92672>*</span><span style=color:#111>nabla</span>
</span></span><span style=display:flex><span>    <span style=color:#111>z2</span><span style=color:#111>,</span> <span style=color:#111>z3</span> <span style=color:#f92672>=</span> <span style=color:#111>(</span><span style=color:#111>I</span><span style=color:#f92672>-</span><span style=color:#111>gamma</span><span style=color:#f92672>*</span><span style=color:#111>T</span><span style=color:#75af00>@theta2</span><span style=color:#111>)</span><span style=color:#f92672>.</span><span style=color:#111>inverse</span><span style=color:#111>(),</span> <span style=color:#111>(</span><span style=color:#111>I</span><span style=color:#f92672>-</span><span style=color:#111>gamma</span><span style=color:#f92672>*</span><span style=color:#111>T</span><span style=color:#75af00>@theta3</span><span style=color:#111>)</span><span style=color:#f92672>.</span><span style=color:#111>inverse</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># search until the middle bounds converged</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>while</span> <span style=color:#111>(</span><span style=color:#111>a4</span><span style=color:#f92672>-</span><span style=color:#111>a1</span><span style=color:#111>)</span> <span style=color:#f92672>&lt;</span> <span style=color:#111>eps</span><span style=color:#f92672>*</span><span style=color:#111>(</span><span style=color:#111>abs</span><span style=color:#111>(</span><span style=color:#111>a2</span><span style=color:#111>)</span> <span style=color:#f92672>+</span> <span style=color:#111>abs</span><span style=color:#111>(</span><span style=color:#111>a3</span><span style=color:#111>)):</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># calculate utility vectors over belief</span>
</span></span><span style=display:flex><span>        <span style=color:#111>u2</span><span style=color:#111>,</span> <span style=color:#111>u3</span> <span style=color:#f92672>=</span> <span style=color:#111>z2</span><span style=color:#75af00>@R</span><span style=color:#111>,</span> <span style=color:#111>z3</span><span style=color:#75af00>@R</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># either relax top or bottom bounds, depending on</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># which one we had been successfully maximizing</span>
</span></span><span style=display:flex><span>        <span style=color:#00a8c8>if</span> <span style=color:#111>b</span><span style=color:#f92672>.</span><span style=color:#111>dot</span><span style=color:#111>(</span><span style=color:#111>u3</span><span style=color:#111>)</span> <span style=color:#f92672>&gt;=</span> <span style=color:#111>b</span><span style=color:#f92672>.</span><span style=color:#111>dot</span><span style=color:#111>(</span><span style=color:#111>u2</span><span style=color:#111>):</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># search &#34;upwards&#34;, set bottom bound to a3</span>
</span></span><span style=display:flex><span>            <span style=color:#111>a1</span><span style=color:#111>,</span> <span style=color:#111>a2</span><span style=color:#111>,</span> <span style=color:#111>a3</span> <span style=color:#f92672>=</span> <span style=color:#111>a2</span><span style=color:#111>,</span> <span style=color:#111>a3</span><span style=color:#111>,</span> <span style=color:#111>a2</span><span style=color:#f92672>+</span><span style=color:#111>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#111>phi</span><span style=color:#111>)</span><span style=color:#f92672>*</span><span style=color:#111>(</span><span style=color:#111>a4</span><span style=color:#f92672>-</span><span style=color:#111>a2</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>            <span style=color:#111>theta3</span><span style=color:#111>,</span> <span style=color:#111>theta2</span> <span style=color:#f92672>=</span> <span style=color:#111>theta</span> <span style=color:#f92672>+</span> <span style=color:#111>a3</span><span style=color:#f92672>*</span><span style=color:#111>nabla</span><span style=color:#111>,</span> <span style=color:#111>theta3</span>
</span></span><span style=display:flex><span>            <span style=color:#111>z3</span><span style=color:#111>,</span> <span style=color:#111>z2</span> <span style=color:#f92672>=</span> <span style=color:#111>(</span><span style=color:#111>I</span><span style=color:#f92672>-</span><span style=color:#111>gamma</span><span style=color:#f92672>*</span><span style=color:#111>T</span><span style=color:#75af00>@theta2</span><span style=color:#111>)</span><span style=color:#f92672>.</span><span style=color:#111>inverse</span><span style=color:#111>(),</span> <span style=color:#111>z3</span>
</span></span><span style=display:flex><span>        <span style=color:#00a8c8>else</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># search &#34;downwards&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#111>a1</span><span style=color:#111>,</span> <span style=color:#111>a3</span><span style=color:#111>,</span> <span style=color:#111>a2</span> <span style=color:#f92672>=</span> <span style=color:#111>a2</span><span style=color:#111>,</span> <span style=color:#111>a2</span><span style=color:#111>,</span> <span style=color:#111>a3</span><span style=color:#f92672>-</span><span style=color:#111>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#111>phi</span><span style=color:#111>)</span><span style=color:#f92672>*</span><span style=color:#111>(</span><span style=color:#111>a3</span><span style=color:#f92672>-</span><span style=color:#111>a1</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>            <span style=color:#111>theta2</span><span style=color:#111>,</span> <span style=color:#111>theta3</span> <span style=color:#f92672>=</span> <span style=color:#111>theta</span> <span style=color:#f92672>+</span> <span style=color:#111>a2</span><span style=color:#f92672>*</span><span style=color:#111>nabla</span><span style=color:#111>,</span> <span style=color:#111>theta2</span>
</span></span><span style=display:flex><span>            <span style=color:#111>z2</span><span style=color:#111>,</span> <span style=color:#111>z3</span> <span style=color:#f92672>=</span> <span style=color:#111>(</span><span style=color:#111>I</span><span style=color:#f92672>-</span><span style=color:#111>gamma</span><span style=color:#f92672>*</span><span style=color:#111>T</span><span style=color:#75af00>@theta2</span><span style=color:#111>)</span><span style=color:#f92672>.</span><span style=color:#111>inverse</span><span style=color:#111>(),</span> <span style=color:#111>z2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># return the average of our converged results</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>return</span> <span style=color:#ae81ff>0.5</span><span style=color:#f92672>*</span><span style=color:#111>(</span><span style=color:#111>theta2</span><span style=color:#f92672>+</span><span style=color:#111>theta3</span><span style=color:#111>),</span> <span style=color:#ae81ff>0.5</span><span style=color:#f92672>*</span><span style=color:#111>(</span><span style=color:#111>u2</span><span style=color:#f92672>+</span><span style=color:#111>u3</span><span style=color:#111>)</span>
</span></span></code></pre></div><h3 id=naive-projection>Naive Projection</h3><p>Once we obtain a new set of parameters \(\xi\) from <a href=#golden-section-line-search>Golden Section Line Search</a>, we can&rsquo;t actually directly punch it into \(\theta\). This is because it is likely not going to satisfy the constraints that are given.</p><p>We can fix this naively with a non-linear programming formulation; that is, we desire to find the closest \(\theta\) to the computed value \(\xi\); we do this by minimizing a L2 norm (sum of squared errors):</p><p>\begin{align}
\min_{\theta}\ & \frac{1}{2} \| \xi - \theta \|^{2}_{2} \\
\text{such that}\ &amp;J\theta = 1 \\
& \theta \geq 0 \\
& h_{i}(\theta) \leq \epsilon_{i},\ \forall i
\end{align}</p><p>This, for the most part, is computationally intractable and needs to be computed through each iteration. This is especially bad for the \(h_{i}\) for all \(i\) part. And so, instead of doing this, we formulate instead an approximate proxy objective.</p><h3 id=approximate-projection>Approximate Projection</h3><p>The thing that makes the objective above hard is that \(h_{i}\) doesn&rsquo;t have nice convex properties. To fix this, we perform a local linearizion of \(h_{i}\).</p><p>Specifically, let&rsquo;s replace \(h_{i}\) with its local Taylor expansion.</p><p>For some step where we started at \(\theta_{k}\), if you wanted to evaluate some next step \(\theta_{k+1}\) from that step, we can write:</p><p>\begin{equation}
h_{i}(\theta_{k+1}) \approx h_{i}(\theta_{k}) + (\nabla_{\theta}(\theta_{0}))(\theta_{k+1}-\theta_{k})
\end{equation}</p><p>Using this linear decomposition of three parts (i.e. parameter difference from original, the gradient of \(h\) against the parameter, and the original value of \(h\)), we can now split the \(h_{i}(\theta)\) constraint of the non-linear program into a linear decomposition.</p><p>Let&rsquo;s define:</p><p>\begin{equation}
\nabla_{\theta} \bold{h}(\theta) = \mqty[ (\nabla_{\theta} h_{1}(\theta))^{\top} \\ \dots \\ (\nabla_{\theta} h_{m}(\theta))^{\top}]
\end{equation}</p><p>From which we write block matriix</p><p>\begin{equation}
\bold{A} = \mqty[-\bold{I}_{n} \\ \nabla_{\theta}\bold{h}(\theta_{k})]
\end{equation}</p><p>where \(\bold{I}_{n} \in \mathbb{R}^{(|A| + |X|) \times (|A| + |X|)}\), and vector:</p><p>\begin{equation}
\bold{b} = \mqty[\bold{0}_{n} \\ \epsilon - \bold{h}(\theta_{k}) + \nabla\bold{h}(\theta_{k})\theta_{k}]
\end{equation}</p><p>These definitions allow us to rewrite two of our objectives:</p><p>\begin{equation}
\begin{cases}
\theta \geq 0 \\
h_{i}(\theta) \leq \epsilon_{i},\ \forall i
\end{cases}
\end{equation}</p><p>turning them instead into simply \(\bold{A}\theta \leq \bold{b}\). The top half of \(\bold{A}\), \(\bold{B}\) is responsible for making sure that all elements of \(\theta\) is positive (specifically, to ensure the negative of the values is smaller than 0); the bottom half ensures that all of them satisfy the cost.</p><p>These definitions result in a linear formulation of two objectives of our original non-linear program:</p><p>\begin{align}
\min_{\theta}\ & \frac{1}{2} \| \xi - \theta \|^{2}_{2} \\
\text{such that}\ &amp;J\theta = 1 \\
& \bold{A}\theta \leq \bold{B}
\end{align}</p><p>and we are done.</p><h3 id=quick-tip>Quick Tip</h3><p>Recall that we have to calculate the inverse of \(\bold{Z}\) quite a lot throughout the computation of \(h\) and \(f\). For each policy parameter \(\theta\), you can cache the value of \(\bold{Z}\), L-U (<a href=/posts/kbhupper_triangular_matrix/>upper-triangular</a>/lower-triangular factored) and recombine them/invert them as needed to speed up computation. This ensures that you only calculate \(\bold{Z}\) once per step.</p></div></article></main><footer style=margin-top:20px><p id=footer style=font-size:8px;color:var(--gray-3)>&copy; 2019-2025 Houjun Liu. Licensed CC BY-NC-SA 4.0.</p></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.32.2/tocbot.min.js></script><script>tocbot.init({tocSelector:"#toc",contentSelector:".center-clearfix",headingSelector:"h1, h2, h3",hasInnerContainers:!0})</script></body></html>