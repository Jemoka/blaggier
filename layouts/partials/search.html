<span style="float: right; display: flex; align-items: center; margin-top: 5px; width: 100%; max-width: 400px; background: white; border-radius: 2px; border: 1px solid var(--gray-2); position: relative">
    <i class="fa-solid fa-magnifying-glass" style="font-size: 12px; color: var(--yellow-fg); margin-right: 7px; margin-left: 10px"></i>
    <div style="width: 100%">
        <input id="search-query-inline" name="s" type="text" autocomplete="off" placeholder="Search Knowledgebase" enterkeyhint="search"/>
    </div>
    <div id="search-result-inline" style="display:none">
        <!-- <div class="search-result-item"> -->
        <!--     <div class="search-result-title">I'm a chicken</div> -->
        <!--     <div class="search-result-summary">The chicken (Gallus gallus domesticus) is a domesticated</div> -->
        <!-- </div> -->
        <!-- <div class="search-result-item"> -->
        <!--     <div class="search-result-title">I'm a chicken</div> -->
        <!--     <div class="search-result-summary">The chicken (Gallus gallus domesticus) is a domesticated</div> -->
        <!-- </div> -->

    </div>


<script id="search-result-template" type="text/x-js-template" data-template="searchresult">
    <a href="${link}" class="search-link">
    <div class="search-result-item" id="search-result-item-${key}">
        <div class="search-result-title">${title}</div>
        <div class="search-result-summary">${snippet}</div>
    </div>
    </a>
</script>


<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.0/fuse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js"></script>


<script type="module">
    import { create, insertMultiple, search } from 'https://cdn.jsdelivr.net/npm/@orama/orama@latest/+esm'
    let template = $('script[data-template="searchresult"]').text().split(/\$\{(.+?)\}/g);

    function render(props) {
        return function(tok, i) { return (i % 2) ? props[tok] : tok; };
    }

    const db = create({
        schema: {
            title: 'string',
            content: 'string',
        },
    });
    $.get("https://www.jemoka.com/index.json", function(data, status){
        insertMultiple(db, data.map(x =>
            ({title: x.title, content: x.contents, link: x.permalink})));
    });
    $("#search-result-inline").attr("tabindex", "-1");
    $(document).on("click", function (e) {
    if (!$(e.target).closest("#search-query-inline, #search-result-inline").length) {
        $("#search-result-inline").hide();
    }
    });
    // $("#search-query-inline").on("blur", function () {
    //     if ($(e.relatedTarget).closest("#search-result-inline").length > 0) {
    //         return;
    //     }
    //     $("#search-result-inline").hide();
    // });

    $("#search-query-inline").on("focus keyup", function () {
        let value = $(this).val();
        if (value.trim() == "") {
            $("#search-result-inline").html("");
            $("#search-result-inline").hide();
            return;
        }
        $("#search-result-inline").show();
        let results = search(db, {mode: "fulltext", term: value});
        let contents = results.hits.map(x => template.map(render({
            title: x.document.title,
            snippet: x.document.content.slice(0, 52),
            key: x.id,
            link: x.document.link
        })).join(''));
        $("#search-result-inline").html(contents.join("\n"));
        // results.map()
    });
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
        $('#search-query-inline').on('focus', function(){
            // replace CSS font-size with 16px to disable auto zoom on iOS
            $(this).data('fontSize', $(this).css('font-size')).css('font-size', '16px');
        }).on('blur', function(){
            // put back the CSS font-size
            $(this).css('font-size', $(this).data('fontSize'));
        });
    }

</script>


</span>
